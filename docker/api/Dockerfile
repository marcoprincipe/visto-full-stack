###########################################################################################################
# Inicia a geração da imagem
###########################################################################################################

FROM ubuntu:latest

###########################################################################################################
# instala a jre 1.8
###########################################################################################################

RUN apt update && apt install -y openjdk-8-jre

###########################################################################################################
# instala o python 3.8 e o pip3
###########################################################################################################

RUN apt install -y python3 && apt install -y python3-pip

###########################################################################################################
# instala o pika para acesso ao rabbitmq
###########################################################################################################

RUN python3 -m pip install pika && python3 -m pip install mysql-connector-python

###########################################################################################################
# Efetua a criação dos diretórios
###########################################################################################################

RUN mkdir -v -p visto/bin && mkdir visto/log

###########################################################################################################
# Copia os arquivos para os diretórios
###########################################################################################################

COPY visto-full-stack-1.0.0.jar /visto/bin 
COPY message-receiver.py /visto/bin
COPY start-services.sh /visto/bin

###########################################################################################################
# Expões a porta 8081 para acesso a api
###########################################################################################################

EXPOSE 8081:8081

###########################################################################################################
# Inicia a execução da aplicação
###########################################################################################################

ENTRYPOINT ["/visto/bin/start-services.sh"]
